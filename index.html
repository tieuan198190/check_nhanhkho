<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Máy Tính Lương Nhân Viên Cô Mập Fashion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .salary-card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-radius: 12px;
            overflow: hidden;
        }
        .result-item {
            transition: all 0.2s ease;
        }
        .result-item:hover {
            background-color: #f1f5f9;
        }
        .final-salary {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
        input:focus, select:focus {
            box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.3);
        }
        .info-badge {
            background-color: #eff6ff;
            color: #1d4ed8;
        }
        /* Ensure number inputs show numeric keypad on mobile */
        input[type=number] {
            -moz-appearance: textfield; /* Firefox */
        }
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body class="min-h-screen py-8 px-4 sm:px-6 lg:px-8">
    <div class="max-w-2xl mx-auto">
        <div class="salary-card bg-white">
            <div class="bg-blue-600 px-6 py-4">
                <h1 class="text-2xl font-bold text-white text-center">
                    <i class="fas fa-calculator mr-2"></i> Cô Mập Fashion
                </h1>
            </div>

            <div class="px-6 py-4 border-b">
                <div class="info-badge px-4 py-2 rounded-lg flex flex-wrap items-center justify-center gap-x-4 gap-y-2 text-sm font-medium">
                    <div class="flex items-center">
                        <i class="fas fa-calendar-alt mr-2"></i>
                        <span>Kỳ tính lương: <span id="kyTinhLuong" class="font-bold">Đang tải...</span></span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-calendar-check mr-2"></i>
                        <span>Ngày công chuẩn: <span id="ngayCongChuan" class="font-bold">Đang tải...</span></span>
                    </div>
                </div>
            </div>

            <div class="px-6 py-4 space-y-4">
                <div>
                    <label for="luongCoBan" class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-money-bill-wave mr-2 text-blue-500"></i>Lương cơ bản (VNĐ)
                    </label>
                    <select id="luongCoBan" class="mt-1 block w-full pl-3 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-lg border">
                        <option value="6500000">6.500.000</option>
                        <option value="7000000">7.000.000</option>
                        <option value="7500000">7.500.000</option>
                        <option value="8000000">8.000.000</option>
                        <option value="8500000">8.500.000</option>
                        <option value="9000000">9.000.000</option>
                        <option value="9500000">9.500.000</option>
                        <option value="10000000">10.000.000</option>
                        <option value="10500000">10.500.000</option>
                        <option value="11000000">11.000.000</option>
                        <option value="11500000">11.500.000</option>
                        <option value="12000000">12.000.000</option>
                        <option value="12500000">12.500.000</option>
                        <option value="13000000">13.000.000</option>
                        <option value="13500000">13.500.000</option>
                        <option value="14000000">14.000.000</option>
                        <option value="14500000">14.500.000</option>
                        <option value="15000000">15.000.000</option>
                        <option value="15500000">15.500.000</option>
                        <option value="16000000">16.000.000</option>
                        </select>
                </div>

                <div>
                    <label for="soNgayNghi" class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-bed mr-2 text-red-500"></i>Số ngày nghỉ
                    </label>
                    <select id="soNgayNghi" class="mt-1 block w-full pl-3 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-lg border">
                         <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9">9</option>
                        <option value="10">10</option>
                    </select>
                </div>

                <div>
                    <label for="soGioNghi" class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-clock mr-2 text-yellow-500"></i>Số giờ nghỉ
                    </label>
                    <select id="soGioNghi" class="mt-1 block w-full pl-3 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-lg border">
                         <option value="0">0</option>
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                    </select>
                </div>

                <div>
                    <label for="gioTangCa" class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-business-time mr-2 text-green-500"></i>Số giờ tăng ca
                    </label>
                    <input type="number" id="gioTangCa" placeholder="Nhập số giờ làm thêm" value="0"
                           inputmode="numeric" class="mt-1 block w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                </div>

                <div>
                    <label for="tamUng" class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-hand-holding-usd mr-2 text-purple-500"></i>Tiền tạm ứng (x1000 VNĐ)
                    </label>
                    <input type="number" id="tamUng" placeholder="Nhập số tiền (vd: 500 cho 500.000)" value="0"
                           inputmode="numeric" class="mt-1 block w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                     <p class="mt-1 text-xs text-gray-500">Nhập số tiền theo đơn vị nghìn đồng (ví dụ: nhập 500 nghĩa là 500.000 VNĐ).</p>
                </div>

                <div>
                    <label for="tienThuong" class="block text-sm font-medium text-gray-700 mb-1">
                        <i class="fas fa-gift mr-2 text-pink-500"></i>Tiền thưởng (x1000 VNĐ)
                    </label>
                    <input type="number" id="tienThuong" placeholder="Nhập số tiền (vd: 100 cho 100.000)" value="0"
                           inputmode="numeric" class="mt-1 block w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                     <p class="mt-1 text-xs text-gray-500">Nhập số tiền theo đơn vị nghìn đồng (ví dụ: nhập 100 nghĩa là 100.000 VNĐ).</p>
                </div>

                <button onclick="tinhLuong()" class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 mt-6">
                    <i class="fas fa-calculator mr-2"></i> TÍNH LƯƠNG
                </button>
            </div>

            <div id="ketqua" class="px-6 py-4 border-t border-gray-200">
                <h2 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-file-invoice-dollar mr-2 text-blue-500"></i> KẾT QUẢ CHI TIẾT
                </h2>

                <div class="space-y-3">
                    <div class="result-item flex justify-between items-center px-3 py-2 rounded-lg">
                        <span class="text-gray-600">Ngày công thực tế:</span>
                        <span class="font-medium"><span id="ngayCongThucTeDisplay">---</span> ngày</span>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mt-4">
                        <div class="result-item flex justify-between items-center px-3 py-2 rounded-lg">
                            <span class="text-gray-600">Lương 1 ngày:</span>
                            <span class="font-medium"><span id="luongNgayCong">---</span> VNĐ</span>
                        </div>

                        <div class="result-item flex justify-between items-center px-3 py-2 rounded-lg">
                            <span class="text-gray-600">Lương 1 giờ:</span>
                            <span class="font-medium"><span id="luongGioBT">---</span> VNĐ</span>
                        </div>

                        <div class="result-item flex justify-between items-center px-3 py-2 rounded-lg">
                            <span class="text-gray-600">Lương tăng ca (x1.5):</span>
                            <span class="font-medium"><span id="luongGioTC">---</span> VNĐ</span>
                        </div>

                        <div class="result-item flex justify-between items-center px-3 py-2 rounded-lg">
                            <span class="text-gray-600">Lương trừ 1 giờ nghỉ:</span>
                            <span class="font-medium"><span id="luongGioNghi">---</span> VNĐ</span>
                        </div>
                    </div>

                    <div class="border-t border-gray-200 pt-3 mt-3 space-y-3">
                        <div class="result-item flex justify-between items-center px-3 py-2 rounded-lg">
                            <span class="text-gray-600">Tổng lương ngày công:</span>
                            <span class="font-medium"><span id="tongLuongTheoCong">---</span> VNĐ</span>
                        </div>

                        <div class="result-item flex justify-between items-center px-3 py-2 rounded-lg">
                            <span class="text-gray-600">Tổng tiền tăng ca:</span>
                            <span class="font-medium"><span id="tongTienTangCa">---</span> VNĐ</span>
                        </div>

                        <div class="result-item flex justify-between items-center px-3 py-2 rounded-lg">
                            <span class="text-gray-600">Tổng tiền trừ giờ nghỉ:</span> <span class="font-medium"><span id="tongTienNghi">---</span> VNĐ</span>
                        </div>

                        <div class="result-item flex justify-between items-center px-3 py-2 rounded-lg">
                            <span class="text-gray-600">Tiền thưởng:</span> <span class="font-medium"><span id="tienThuongDisplay">---</span> VNĐ</span>
                        </div>

                         <div class="result-item flex justify-between items-center px-3 py-2 rounded-lg">
                            <span class="text-gray-600">Tổng thu nhập (trước ứng):</span>
                            <span class="font-medium"><span id="tongThuNhap">---</span> VNĐ</span>
                        </div>

                        <div class="result-item flex justify-between items-center px-3 py-2 rounded-lg bg-red-50 text-red-700">
                            <span class="text-red-600">Tiền tạm ứng:</span> <span class="font-medium"><span id="tamUngDisplay">---</span> VNĐ</span>
                        </div>
                        </div>

                    <div class="final-salary flex justify-between items-center px-4 py-3 rounded-lg mt-4">
                        <span class="font-bold text-gray-800">LƯƠNG THỰC NHẬN:</span>
                        <span class="text-xl font-bold text-blue-600"><span id="luongThucNhan">---</span> VNĐ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let ngayCongChuanThangTruoc = 0;
        let thangTinhLuong = '';
        let namTinhLuong = '';

        // Hàm tính ngày công chuẩn của tháng trước (Thứ 2 - Thứ 7)
        function tinhNgayCongChuanThangTruoc() {
            const homNay = new Date();
            // Lấy ngày đầu tiên của tháng trước
            const ngayDauThangTruoc = new Date(homNay.getFullYear(), homNay.getMonth() - 1, 1);
            namTinhLuong = ngayDauThangTruoc.getFullYear();
            thangTinhLuong = ngayDauThangTruoc.getMonth() + 1; // Tháng bắt đầu từ 0
            // Lấy ngày cuối cùng của tháng trước
            const ngayCuoiThangTruoc = new Date(namTinhLuong, thangTinhLuong, 0);
            const soNgayTrongThang = ngayCuoiThangTruoc.getDate();

            let soNgayCongChuan = 0;
            // Duyệt qua từng ngày trong tháng trước
            for (let ngay = 1; ngay <= soNgayTrongThang; ngay++) {
                const ngayKiemTra = new Date(namTinhLuong, thangTinhLuong - 1, ngay);
                const thuTrongTuan = ngayKiemTra.getDay(); // 0 = Chủ Nhật, 1 = Thứ 2, ..., 6 = Thứ 7
                // Chỉ tính ngày công nếu là từ Thứ 2 đến Thứ 7
                if (thuTrongTuan >= 1 && thuTrongTuan <= 6) {
                    soNgayCongChuan++;
                }
            }
            return soNgayCongChuan;
        }

        // Hàm định dạng tiền tệ VNĐ
        function formatCurrency(number) {
            if (isNaN(number) || number === null) return '---';
            // Làm tròn đến hàng đơn vị trước khi định dạng
            return new Intl.NumberFormat('vi-VN').format(Math.round(number));
        }

        // Hàm làm tròn LÊN đến hàng nghìn gần nhất
        function roundUpToThousand(number) {
             if (isNaN(number) || number === null) return 0;
             // Sử dụng Math.ceil để làm tròn lên
             return Math.ceil(number / 1000) * 1000;
        }

        // Khởi tạo khi tải trang
        window.onload = function() {
            ngayCongChuanThangTruoc = tinhNgayCongChuanThangTruoc();
            document.getElementById('kyTinhLuong').textContent = `${thangTinhLuong}/${namTinhLuong}`;
            document.getElementById('ngayCongChuan').textContent = ngayCongChuanThangTruoc;
            // Đặt lại kết quả khi tải trang
            resetResults();
        };

        // Hàm tính lương chính
        function tinhLuong() {
            // Lấy giá trị từ các input và select
            const luongCoBan = parseFloat(document.getElementById('luongCoBan').value) || 0;
            const soNgayNghi = parseFloat(document.getElementById('soNgayNghi').value) || 0;
            const gioTangCa = parseFloat(document.getElementById('gioTangCa').value) || 0;
            // Nhân giá trị tạm ứng và tiền thưởng với 1000
            const tamUngInput = parseFloat(document.getElementById('tamUng').value) || 0;
            const tienThuongInput = parseFloat(document.getElementById('tienThuong').value) || 0;
            const tamUng = tamUngInput * 1000;
            const tienThuong = tienThuongInput * 1000;
            const soGioNghi = parseFloat(document.getElementById('soGioNghi').value) || 0;


            // Kiểm tra đầu vào cơ bản
            if (luongCoBan <= 0) {
                alert("Vui lòng chọn hoặc nhập Lương cơ bản hợp lệ.");
                resetResults(); // Đặt lại kết quả nếu có lỗi
                return;
            }
            if (ngayCongChuanThangTruoc <= 0) {
                alert("Không thể xác định ngày công chuẩn của tháng trước. Vui lòng kiểm tra lại.");
                resetResults();
                return;
            }
            // Kiểm tra giá trị âm (ngoại trừ trường hợp có thể có thưởng/phạt âm)
            if (soNgayNghi < 0 || gioTangCa < 0 || tamUngInput < 0 || soGioNghi < 0 || tienThuongInput < 0) {
                alert("Các giá trị số ngày nghỉ, giờ tăng ca, tạm ứng, giờ nghỉ, tiền thưởng không được là số âm.");
                resetResults();
                return;
            }
            // Kiểm tra số ngày nghỉ không vượt quá ngày công chuẩn
            if (soNgayNghi > ngayCongChuanThangTruoc) {
                alert(`Số ngày nghỉ (${soNgayNghi}) không thể lớn hơn số ngày công chuẩn (${ngayCongChuanThangTruoc}) của tháng.`);
                resetResults();
                return;
            }

            // --- Tính toán chi tiết ---
            // Ngày công thực tế = Ngày công chuẩn - Số ngày nghỉ
            const ngayCongThucTe = ngayCongChuanThangTruoc - soNgayNghi;

            // Lương 1 ngày công = Lương cơ bản / Ngày công chuẩn
            const luongNgayCong = luongCoBan / ngayCongChuanThangTruoc;

            // Lương 1 giờ làm việc bình thường (giả sử 1 ngày làm 9 tiếng)
            const luongGioBT = luongNgayCong / 9;

            // Lương 1 giờ tăng ca (bằng 1.5 lần lương giờ bình thường)
            const luongGioTC = luongGioBT * 1.5;

            // Tiền bị trừ cho 1 giờ nghỉ (bằng 1 lần lương giờ bình thường)
            const luongGioNghi = luongGioBT * 1; // Thường là bằng lương giờ BT

            // Tổng lương theo ngày công thực tế
            const tongLuongTheoCong = luongNgayCong * ngayCongThucTe;

            // Tổng tiền lương tăng ca
            const tongTienTangCa = gioTangCa * luongGioTC;

            // Tổng tiền bị trừ do nghỉ theo giờ
            const tongTienNghi = soGioNghi * luongGioNghi;

            // Tổng thu nhập = Lương theo công + Tiền tăng ca + Tiền thưởng - Tiền trừ giờ nghỉ
            // Lưu ý: Trừ tiền nghỉ giờ ở đây thay vì ở cuối
            const tongThuNhap = tongLuongTheoCong + tongTienTangCa + tienThuong - tongTienNghi;

            // Lương thực nhận = Tổng thu nhập - Tiền tạm ứng
            const luongThucNhanChuaLamTron = tongThuNhap - tamUng;

            // Làm tròn LÊN lương thực nhận đến hàng nghìn gần nhất
            const luongThucNhan = roundUpToThousand(luongThucNhanChuaLamTron);

            // --- Hiển thị kết quả ---
            document.getElementById('ngayCongThucTeDisplay').textContent = ngayCongThucTe.toFixed(1); // Có thể có nửa ngày
            document.getElementById('luongNgayCong').textContent = formatCurrency(luongNgayCong);
            document.getElementById('luongGioBT').textContent = formatCurrency(luongGioBT);
            document.getElementById('luongGioTC').textContent = formatCurrency(luongGioTC);
            document.getElementById('luongGioNghi').textContent = formatCurrency(luongGioNghi); // Hiển thị tiền trừ 1h nghỉ
            document.getElementById('tongLuongTheoCong').textContent = formatCurrency(tongLuongTheoCong);
            document.getElementById('tongTienTangCa').textContent = formatCurrency(tongTienTangCa);
            document.getElementById('tongTienNghi').textContent = formatCurrency(tongTienNghi); // Hiển thị tổng tiền trừ giờ nghỉ
            document.getElementById('tienThuongDisplay').textContent = formatCurrency(tienThuong); // Hiển thị tiền thưởng
            document.getElementById('tongThuNhap').textContent = formatCurrency(tongThuNhap); // Tổng thu nhập trước ứng
            // *** CẬP NHẬT HIỂN THỊ TIỀN TẠM ỨNG ***
            document.getElementById('tamUngDisplay').textContent = formatCurrency(tamUng); // Hiển thị tiền tạm ứng đã trừ
            // *************************************
            document.getElementById('luongThucNhan').textContent = formatCurrency(luongThucNhan); // Lương cuối cùng
        }

        // Hàm đặt lại tất cả các ô kết quả về '---'
        function resetResults() {
            document.getElementById('ngayCongThucTeDisplay').textContent = '---';
            document.getElementById('luongNgayCong').textContent = '---';
            document.getElementById('luongGioBT').textContent = '---';
            document.getElementById('luongGioTC').textContent = '---';
            document.getElementById('luongGioNghi').textContent = '---';
            document.getElementById('tongLuongTheoCong').textContent = '---';
            document.getElementById('tongTienTangCa').textContent = '---';
            document.getElementById('tongTienNghi').textContent = '---';
            document.getElementById('tienThuongDisplay').textContent = '---';
            document.getElementById('tongThuNhap').textContent = '---';
            // *** RESET HIỂN THỊ TIỀN TẠM ỨNG ***
            document.getElementById('tamUngDisplay').textContent = '---'; // Reset cả tạm ứng
            // **********************************
            document.getElementById('luongThucNhan').textContent = '---';
        }
    </script>
</body>
</html>
